apply plugin: 'java'

// Translation
apply plugin: "org.omegat.gradle"

// FIXME: here is ugly configuration for omegat plugin
dependencies {
    omegat files('buildSrc/OmegaT.jar'),
           fileTree('buildSrc/lib')
}

ext {
    targetDir = new File(rootDir, 'target')
    sourceDir = new File(rootDir, 'source')
    sourcePluginsDir = new File(sourceDir, 'plugin')
}

task cleanTargetDirs(type: Delete) {
    targetDir.listFiles().findAll { it.isDirectory() }.each { delete it }
}

task intellijJar(type: Jar, dependsOn: [jar, 'translate']) {
    inputs.dir new File(targetDir, 'intellij-community')
    destinationDir new File("$buildDir")
    archiveName "resources_ja-intellij-community.jar"
    into('messages') {
        from "$projectDir/target/intellij-community/messages"
    }
    into('fileTemplates_ja') {
        from "$projectDir/target/intellij-commuity/fileTemplates"
    }
    into('inspectionDescriptions_ja') {
        from "$projectDir/target/intellij-community/inspectionDescriptions"
    }
    into('intentionDescriptions_ja') {
        from "$projectDir/target/intellij-community/intentionDescriptions"
    }
    into('postfixTemplates_ja') {
        from "$projectDir/target/intellij-community/postfixTemplates"
    }
    into('search_ja') {
        from "$projectDir/target/intellij-community/search"
    }
    into('tips_ja') {
        from "$projectDir/target/intellij-community/tips"
    }
}

artifacts {
    archives intellijJar
}

dependencies {
    testRuntime intellijJar.outputs.files
}

clean.dependsOn cleanTargetDirs

task wrapper(type: Wrapper) {
  gradleVersion = '2.14.1'
}
